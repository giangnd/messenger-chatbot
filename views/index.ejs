<!DOCTYPE html>
<html>
<head>
	<title>Facebook Marketing</title>
</head>
<body>
	<script>
		(function(d, s, id){
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) {return;}
			js = d.createElement(s); js.id = id;
			js.src = "https://connect.facebook.net/en_US/sdk.js";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

		window.fbAsyncInit = function() {
			FB.init({
				appId            : '<%= app_id %>',
				xfbml            : true,
				version          : 'v2.12'
			});
			FB.Event.subscribe('messenger_checkbox', function(e) {
				console.log("messenger_checkbox event");
				console.log(e);

				if (e.event == 'rendered') {
					console.log("Plugin was rendered");
				} else if (e.event == 'checkbox') {
					var checkboxState = e.state;
					console.log("Checkbox state: " + checkboxState);
				} else if (e.event == 'not_you') {
					console.log("User clicked 'not you'");
				} else if (e.event == 'hidden') {
					console.log("Plugin was hidden");
				}
			});
		};

		function recartMessengerDiscountButton() {
			FB.AppEvents.logEvent('MessengerCheckboxUserConfirmation', null, {
				'app_id': '<%= app_id %>',
				'page_id':'<%= page_id %>',
				'user_ref':'<%= user_ref %>'
			});
		}

	</script>

	<div class="fb-messenger-checkbox"  
	origin="https://re-cart.herokuapp.com/"
	page_id="<%= page_id %>"
	messenger_app_id="<%= app_id %>"
	user_ref="<%= user_ref %>"
	prechecked="true"
	allow_login="true"
	size="medium"
	skin="light"
	center_align="true">
</div> 

<input type="button" onclick="recartMessengerDiscountButton()" value="Get Your Discount"/>

</body>
</html>